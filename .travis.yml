dist: xenial
sudo: required
language: node_js
node_js:
  - "10"

services:
  - xvfb

before_install:
  - "/sbin/start-stop-daemon --start --quiet --pidfile /tmp/custom_xvfb_99.pid --make-pidfile --background --exec /usr/bin/Xvfb -- :99 -ac -screen 0 1600x1200x24"
  - export CHROME_BIN=/usr/bin/google-chrome
  - wget https://dl.google.com/linux/direct/google-chrome-stable_current_amd64.deb
  - sudo dpkg -i google-chrome*.deb
  - google-chrome --version
  
before_script:
  # Rule server build
  - cd rule-server;
  - npm install;
  - npm run build;
  - cd dist;
  - node main.js &
  - sleep 10;   # Give server time to build and start
  - cd ..;
  - cd ..;

jobs:
  include:
    - stage: Test
      script: travis/test_ace.sh
      script: travis/test_achecker_selenium.sh
      script: travis/test_achecker_other.sh
      script: travis/test_karma_achecker_assert.sh
      script: travis/test_karma_achecker_content.sh
      script: travis/test_karma_achecker_other.sh
    - stage: Deploy
      script: echo "Deploy rule server..."
      if: tag IS present
